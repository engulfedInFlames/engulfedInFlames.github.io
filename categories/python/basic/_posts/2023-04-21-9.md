---
title: Basic Python (9) &#58; Async I/O Part 2 - 이벤트 루프
tags: [Python, Async]
sidebar:
  nav: categories
permalink: "/categories/python/basic/9"
article_header:
  type: cover
  image:
    src: /assets/images/python/basic/async_with_python-banner.png
---

<!--more -->

<br/>

&nbsp;&nbsp; 이번 포스트에서는 두 번째 주제 "이벤트 루프"를 다루겠습니다.

1. 병렬 처리의 의미 및 멀티 스레딩과 Async의 차이
2. **이벤트 루프**
3. 코루틴(Coroutines)
4. Coroutines Under The Hood
5. Batteries Included
6. An Example Web Application With Starlette and EdgeDB

&nbsp;&nbsp; 위 6개 주제는 다음의 유튜브 영상을 **참조 요약**한 것으로, 파이썬 Asnyc가 처음이거나, 이해가 잘 안 될 때는 해당 영상을 참조하시기를 바랍니다.

[Import asyncio by EdgeDB](https://www.youtube.com/watch?v=E7Yn5biBZ58&list=PLhNSoGM2ik6SIkVGXWBwerucXjgP1rHmB&index=2)

---

### (1) 이벤트 루프(The Event Loop)란?

&nbsp;&nbsp; 이벤트 루프는 파이썬 asyncio의 핵심으로, 프로그램의 동작 방식에 관한 모델 중 하나입니다. 이벤트 루프는 코드를 실행하고, 데이터를 수집 및 처리하며, 큐(Queue) 대기열에 있는 하위 작업들을 처리합니다.

&nbsp;&nbsp; 프로그램이 동작한다는 것은 코드를 실행하고, 데이터를 수집 및 처리한다는 것과 같은 말입니다. 이상할 것 없습니다. 단지, 이벤트 루프에는 데이터를 수집 및 처리하는 데에 지연 시간(Latency)이 있는 작업들을 큐 대기열에 추가하고, 실행할 준비가 됐을 때 이 작업들을 순서대로 처리하는 과정이 추가되어 있습니다. 큐 대기열에 있는 하위 작업들이 실행될 준비를 하고 있는 동안 프로그램은 다른 작업들을 수행할 수 있기 때문에 블로킹(Blocking)이 발생하지 않습니다.

> 블로킹(Blokcing) : 호출된 작업이 완료될 때까지 다음 작업을 수행하지 않는 것. 실행 흐름이 중단됨.

> 논블로킹(Non-blokcing) : 호출된 작업이 완료 여부와 상관없이 필요한 다음 작업을 수행하는 것. 실행 흐름이 중단되지 않음.

&nbsp;&nbsp; 요컨대 이벤트 루프 이해의 핵심은 다음 세 가지입니다. 아래의 세 가지 실제로 어떻게 구현되고 있는지에 대해서는 차후의 내용(또는 포스트)에서 다룰 예정입니다.

1. Scheduling
2. Non-blocking
3. One task at a time

&nbsp;&nbsp; 큐 대기열에 하위 작업이 쌓이게 되면 '언제 실행해야 하는가'를 염두에 두지 않으면 안 됩니다. 이것이 "스케쥴링"입니다.

&nbsp;&nbsp; 또한, 이벤트 루프는 Async I/O, 즉, 비동기 처리와 한쌍이기 때문에, "논블로킹" 방식으로 작업을 처리해야 합니다. 도중에 작업 흐름이 중단돼서는 안 됩니다.

&nbsp;&nbsp; 언뜻 보면, Async라든지 이벤트 루프라는 것이 멀티태스킹, 즉 '동시에 여러 가지 일을 하는 것'처럼 보일 수 있습니다. 하지만 이벤트 루프는 멀티태스킹을 하는 것이 아닙니다. 이벤트 루프는 한 번에 한 가지일만 처리할 수 있습니다. 다만, 해야 할 일들을 계속해서 "주시"하고 있을 뿐입니다. 어떤 작업이 완료되는 데 시간이 걸린다면, 그것을 이벤트로 간주하고 큐 대기열에 추가합니다. 그리고 다른 작업을 수행합니다. 큐 대기열에 추가된 하위 작업들은 프로그램이 여유(?)가 있을 때 꺼내어 처리하는 것입니다.

### (2) 이벤트 루프 in 파이썬

<br/>

<div align="center">
<img src= /assets/images/python/basic/python_event_loop.png/>
<p>[Python Tutorial](https://www.iloveimg.com/ko/download/q08vz881zwpxqlnnfyqtprv23kkpwdkn4l013psfj0s4zvt5t5qb33g7l9p3jAljrjs6n77jd84bm75vm9wtlA700knfpgkAsc8kp30AAhwrzAbrrAylvxwh1hkhprtqr60dhptdfrvlkwlz22Ac2q5l2g7f3pxgzyp15krrxkmjhp7s2A01/3)</p>
</div>

<br/>

&nbsp;&nbsp; 프로그램은 일반적으로 하나의 프로세스에 멀티 스레드로 동작합니다. 그렇다면 파이썬 스크립트를 멀티 스레드로 동작시키면 몇 개의 이벤트 루프가 만들어질까요?

&nbsp;&nbsp; 답은 정해져 있지 않습니다. 필요하다면 여러 개의 이벤트 루프를 만들 수 있습니다. 하지만 파이썬은 디폴트로 메인 스레드에 한 개의 이벤트 루프만을 생성합니다. 이벤트 루프를 추가하고 싶다면, 사용자가 수동으로 해야만 합니다.

&nbsp;&nbsp; 파이썬이 메인 스레드에 한 개의 이벤트 루프만을 생성하는 가장 큰 이유는 바로 프로그래밍을 단순하고 일관되게 하기 위해서입니다. 이벤트 루프를 두 개 이상 만들게 되면, 사용자는 이벤트마다 각각 어떤 이벤트 루프의 큐 대기열에 추가되어야 하는지를 고민해야 합니다. 게다가, 이벤트 루프를 추가하면 큐 대기열로 사용될 힙을 또 만들어야 하기 때문에 리소스 활용 측면에서도 낭비가 될 수 있습니다.

&nbsp;&nbsp; 필요하다면 이벤트 루프를 몇 개 더 생성할 수 있겠지만, 파이썬은 대체로 이를 불필요하다고 판단한 것입니다.

&nbsp;&nbsp; (파이썬 튜토리얼 내용)

### (3) UV 루프 : 리뉴얼 이벤트 루프

(UV 루프란?)

(이벤트 루프보다 나은 점)

(작동 방식)

**출처**

[Import asyncio by EdgeDB](https://www.youtube.com/watch?v=E7Yn5biBZ58&list=PLhNSoGM2ik6SIkVGXWBwerucXjgP1rHmB&index=2)
[MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Event_loop)
