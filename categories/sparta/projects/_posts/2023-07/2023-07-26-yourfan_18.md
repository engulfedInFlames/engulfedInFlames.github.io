---
title: "youRFan (18) : íšŒì›ê°€ì… ë·° í´ë˜ìŠ¤ ë¦¬íŒ©í† ë§í•˜ê¸°"
tags: [Sparta, DRF]
sidebar:
  nav: categories
permalink: "/categories/sparta/projects/yourfan_18"
---

<div class="article__content" markdown="1">

&ensp; íšŒì›ê°€ì… ë·° í´ë˜ìŠ¤ì™€ ìœ ì € ì•± ì‹œë¦¬ì–¼ë¼ì´ì €ë¥¼ ë¦¬íŒ©í† ë§í•˜ê² ìŠµë‹ˆë‹¤.

---

## (1) ~~íšŒì›ê°€ì… ë·° í´ë˜ìŠ¤ ë¦¬íŒ©í† ë§~~

### í˜„ì¬ ìƒí™©

&ensp; í˜„ì¬ íšŒì›ê°€ì… ë·° í´ë˜ìŠ¤ëŠ” ë¦¬í€˜ìŠ¤íŠ¸ ë°ì´í„°ì—ì„œ ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸, í™•ì¸ ë¹„ë°€ë²ˆí˜¸, ë‹‰ë„¤ì„, íœ´ëŒ€í° ë²ˆí˜¸ ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ê³ , íšŒì›ê°€ì… ë°ì´í„° í˜•ì‹ì„ ê²€ì¦í•˜ëŠ” `validate_signup_info` ë©”ì†Œë“œì— í•´ë‹¹ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  `validate_signup_info`ì—ì„œ ë°¸ë¦¬ë°ì´ì…˜ì— ì‹¤íŒ¨í•˜ë©´ 400ë²ˆ ì—ëŸ¬ ì½”ë“œì˜ ë¦¬ìŠ¤í°ìŠ¤ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

```python
class Signup(APIView):
    def post(self, request):
        email_id = request.data.get("email_id")
        password1 = request.data.get("password1", None)
        password2 = request.data.get("password2", None)
        nickname = request.data.get("nickname", None)
        phone_number = request.data.get("phone_number", None)

        data = validate_signup_info(
            request.data
        )
        ...

def validate_signup_info(email_id, password1, password2, nickname, phone_number):
     try:
        condition1 = all([password1, password2])
        condition2 = password1 == password2
        if not all([condition1, condition2]):
            raise ValidationError
        validate_password(password1)
    except:
        return Response(
            {"message": "ë¹„ë°€ë²ˆí˜¸ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"},
            status=status.HTTP_400_BAD_REQUEST,
        )
    ...
```

&ensp; ì´ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ë¦¬íŒ©í† ë§í•  ê²ƒì…ë‹ˆë‹¤.

1. íšŒì›ê°€ì… ë°ì´í„°ë¥¼ ì¼ì¼ì´ ì¶”ì¶œí•˜ì§€ ì•Šê³ , `request.data`ë¥¼ `validate_signup_info`ì— ì „ë‹¬
2. ë°¸ë¦¬ë°ì´ì…˜ì— ì‹¤íŒ¨í–ˆì„ ë•Œ, ë¦¬ìŠ¤í°ìŠ¤í•˜ëŠ” ëŒ€ì‹  `ValidationError`ë¥¼ ë°œìƒì‹œí‚¤ë„ë¡ ìˆ˜ì •

### ë¦¬í€˜ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ í†µì§¸ë¡œ ì „ë‹¬í•˜ê¸°

```python
# ë³€ê²½ ì „
class Signup(APIView):
    def post(self, request):
        email_id = request.data.get("email_id")
        password1 = request.data.get("password1", None)
        password2 = request.data.get("password2", None)
        nickname = request.data.get("nickname", None)
        phone_number = request.data.get("phone_number", None)

        data = validate_signup_info(
            request.data
        )
        ...

# ë³€ê²½ í›„
class Signup(APIView):
    def post(self, request):
        data = None
        try:
            data = validate_signup_info(request.data)
        except exceptions.ValidationError as err:
            error_message = err.args[0]
            return Response(
                data={"error_message": error_message},
                status=status.HTTP_400_BAD_REQUEST,
            )

        serializer = serializers.CreateUserSerializer(data=data)
        if serializer.is_valid():
            try:
                with transaction.atomic():
                    serializer.save()
                    return Response(status=status.HTTP_201_CREATED)
            except Exception as err:
                error_message = err.args[0]
                return Response(
                    data={"error_message": error_message},
                    status=status.HTTP_400_BAD_REQUEST,
                )
        else:
            return Response(
                serializer.errors,
                status=status.HTTP_400_BAD_REQUEST,
            )
        ...
```

&ensp; ë¦¬í€˜ìŠ¤íŠ¸ ë°ì´í„°ì—ì„œ ì´ë©”ì¼ ë“± êµ¬ì²´ì ì¸ ë°ì´í„°ë¥¼ ì¶”ì¶œí•  ì´ìœ ê°€ ì—†ìŠµë‹ˆë‹¤. `request.data`ë¥¼ í†µì§¸ë¡œ ì „ë‹¬í•˜ì—¬ `validate_signup_info`ì—ì„œ ì¶”ì¶œí•˜ë„ë¡ ì½”ë“œë¥¼ ë³€ê²½í–ˆìŠµë‹ˆë‹¤. íšŒì›ê°€ì… ì…ë ¥ ë°ì´í„°ì— ëŒ€í•œ ë°¸ë¦¬ë°ì´ì…˜ì´ ì¢…ë£Œë˜ë©´ ìœ ì € ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ìœ ì € ê°ì²´ ìƒì„± ê³¼ì •ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ì¥ê³ ê°€ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±í•  ìˆ˜ ìˆë„ë¡ `with transaction.atomic()` APIë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

### ValidationError

&ensp; ë°¸ë¦¬ë°ì´ì…˜ì— ì‹¤íŒ¨í–ˆì„ ë•ŒëŠ” ì‹¤íŒ¨í•œ ì´ìœ ì™€ í•¨ê»˜ `ValidationError`ë¥¼ ë°œìƒì‹œí‚¤ë„ë¡ ë³€ê²½í•˜ê² ìŠµë‹ˆë‹¤.

```python
def validate_signup_info(data):
    """íšŒì›ê°€ì…ì‹œì— ì…ë ¥í•œ ë°ì´í„°ì˜ ìœ íš¨ì„±ì„ ê²€ì¦í•©ë‹ˆë‹¤"""

    email_id = data.get("email_id")
    password1 = data.get("password1")
    password2 = data.get("password2")
    nickname = data.get("nickname")
    phone_number = data.get("phone_number")

    if not all([email_id, password1, password2, nickname, phone_number]):
        raise ValidationError("ì…ë ¥ë˜ì§€ ì•Šì€ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì´ ìˆìŠµë‹ˆë‹¤")
    ...
```

<br/>

## (2) ë‹¤ì‹œ íšŒì›ê°€ì… ë·° í´ë˜ìŠ¤ ë¦¬íŒ©í† ë§í•˜ê¸°

&ensp; ì½”ë“œë¥¼ ë‹¤ì‹œ ì‚´í´ë³´ë‹ˆ, ìœ„ì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ í•  í•„ìš”ê°€ ì—†ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤. ëŒ€ì‹  ì‹œë¦¬ì–¼ë¼ì´ì €ì—ì„œ ì˜¤ë¸Œì íŠ¸ ìˆ˜ì¤€ìœ¼ë¡œ ë°¸ë¦¬ë°ì´ì…˜ì„ ìˆ˜í–‰í•˜ì—¬ ë³´ë‹¤ ì™„ì„±ë„ ìˆëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.

### CreateUserSerializer

&ensp; `CreateUserSerializer`ì—ì„œëŠ” ë°¸ë¦¬ë°ì´ì…˜ì´ ì™„ë£Œëœ íšŒì›ê°€ì… ë°ì´í„°ë¥¼ ë°›ì•„ì„œ ìœ ì € ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í–ˆìŠµë‹ˆë‹¤. ì´ì œëŠ” `CreateUserSerializer`ì—ì„œ ë°¸ë¦¬ë°ì´ì…˜ì´ ìˆ˜í–‰ë˜ì§€ ì•Šì€ íšŒì›ê°€ì… ë°ì´í„°, ì¦‰, `request.data`ë¥¼ ì „ë‹¬í•˜ì—¬ ì‹œë¦¬ì–¼ë¼ì´ì € ë‚´ë¶€ì—ì„œ ë°¸ë¦¬ë°ì´ì…˜ì„ ìˆ˜í–‰í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. `CreateUserSerializer`ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ë³€ê²½í•©ë‹ˆë‹¤.

```python
# ë³€ê²½ ì „
class CreateUserSerializer(serializers.ModelSerializer):
    password = serializers.CharField(required=True)
    nickname = serializers.CharField(allow_blank=True)

    class Meta:
        model = CustomUser
        fields = (
            "email",
            "password",
            "nickname",
            "phone_number",
        )

    def create(self, validated_data):
        user = super().create(validated_data)
        password = validated_data.get("password")

        if not user.nickname:
            user.nickname = f"user#{user.pk}"

        user.set_password(password)
        user.is_active = True
        user.save()
        return user

# ë³€ê²½ í›„
class CreateUserSerializer(serializers.ModelSerializer):
    password1 = serializers.CharField(required=True)
    password2 = serializers.CharField(required=True)
    nickname = serializers.CharField(allow_blank=True)

    class Meta:
        model = CustomUser
        fields = (
            "email",
            "password1",
            "password2",
            "nickname",
            "phone_number",
        )

    def validate(self, data):
        data = super().validate(data)
        validate_signup_info(data)
        return data

    def create(self, validated_data):
        user = super().create(validated_data)
        password = validated_data.get("password1")

        if not user.nickname:
            user.nickname = f"user#{user.pk}"

        user.set_password(password)
        user.is_active = True
        user.save()
        return user
```

&ensp; ì´ë ‡ê²Œ ë˜ë©´ `validate_signup_info`ê°€ ë°ì´í„°ë¥¼ ë°˜í™˜í•  í•„ìš”ê°€ ì—†ì–´ì§‘ë‹ˆë‹¤. ë°¸ë¦¬ë°ì´ì…˜ë§Œì„ ìˆ˜í–‰í•˜ê³ , `CreateUserSerializer`ì˜ `validate` ë©”ì†Œë“œê°€ ë°ì´í„°ë¥¼ ë°˜í™˜í•  ê²ƒì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë°˜í™˜ëœ ë°ì´í„°ëŠ” `create` ë©”ì†Œë“œì˜ `validated_data`ë¡œ ë“¤ì–´ì˜¤ê²Œ ë©ë‹ˆë‹¤.

&ensp; ìµœì¢…ì ìœ¼ë¡œ ë¦¬íŒ©í† ë§ ëœ `Signup` ë·° í´ë˜ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```python
class Signup(APIView):
    def post(self, request):
        """íšŒì› ê°€ì…"""
        serializer = serializers.CreateUserSerializer(data=request.data)
        if serializer.is_valid():
            with transaction.atomic():
                serializer.save()
                return Response(status=status.HTTP_201_CREATED)
        else:
            return Response(
                serializer.errors,
                status=status.HTTP_400_BAD_REQUEST,
            )
```

<br/>

## (3) ê²°ë¡ 

&ensp; ìê¸°ê°€ ì‘ì„±í•œ ì½”ë“œë¥¼ ë‹¤ì‹œ í•œ ë²ˆ ë³´ê³ , ë¦¬íŒ©í† ë§í•´ë³´ëŠ” ê²ƒì´ ì°¸ ì¤‘ìš”í•œ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë³¼ ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ ë¶€ë¶„ë“¤ì´ ëˆˆì— ë“¤ì–´ì˜¤ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë” ê°„ê²°í•˜ê³  ë…¼ë¦¬ì ì¸ ì½”ë“œê°€ ë˜ë„ë¡ ê³„ì†í•´ì„œ ë¦¬íŒ©í† ë§ì„ ìˆ˜í–‰í•´ë‚˜ê°€ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

---

## ğŸ“š ì°¸ê³ 

[DRF: Serializer](https://www.django-rest-framework.org/api-guide/serializers/#validation)

</div>
