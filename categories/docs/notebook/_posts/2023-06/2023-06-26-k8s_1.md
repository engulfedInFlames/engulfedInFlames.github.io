---
title: "쿠버네티스 (1) : 쿠버네티스(k8s)란?"
tags: [k8s]
sidebar:
  nav: categories
permalink: /categories/docs/notebook/k8s_1/
article_header:
  type: cover
  image:
    src: /assets/images/docs/notebook/kubernetes-banner.svg
---

<div class="article__content" markdown="1">

&ensp;

## ✅ k8s란?

- k8s는 컨테이너 자동화 관리 도구 - 배포, 스케일링, 로드 밸런싱, 헬스 체크, 시크릿 관리 등 컨테이너와 관련된 서비스 전반을 제어
- k8s는 도커의 확장판
- 클러스터 내에서 앱 컨테이너들을 관리하기 위한 견고한 인프라를 조성
- 도커가 이미지를 빌드 및 패키징하고 배포하는 데에 주목한다면, k8s는 패키징된 컨테이너를 배포하고 관리하는 데에 주목
- 극단적인 예로 도커만으로는 컨테이너가 다운됐을 때의 상황에 대처하기 어려움
- 한편으로 k8s는 앱 수준에서의 서비스는 제공하지 않음

<br/>

## ✅ k8s의 구성 요소

### 포드(Pod)

- k8s를 구성하는 최소 단위
- 하나 이상의 컨테이너 컬렉션이며 동시에 컨테이너의 런타임
- 각 포드는 고유 IP 주소를 가짐
- 한 포드 내의 컨테이너들은 IP 주소와 볼륨을 공유
- 일반적으로 하나의 포드에 하나의 애플리케이션을 할당
- 리소스 공유를 원활하게 하고 싶을 때, 한 포드 내에 여러 개의 컨테이너를 실행시키는 방안을 고려
- **Ephemeral** : 포드는 제거될 수 있으며, 재생성됐을 때는 새로운 IP가 할당됨

### 서비스(Service)

- 포드 내의 컨테이너들을 외부에 노출시키기 위한 수단
- 컨테이너가 어떻게 빌드되었는지와 상관없이 클러스터 내외부를 연결하는 통로 역할
- 디플로이먼트는 이상적인 상태를 유지하기 위해 언제든 포드를 파괴하고 재생성할 수 있는데, 서비스는 그 과정에서 동적으로 변하는 포드의 IP를 묶기 위한 수단이 됨
- 즉, 서비스는 포드에 할당되는 영구 IP 주소 - 포드와 서비스의 생명주기가 별개

```zsh
# 서비스 ip 예시

# 앱 서비스 ip 예시
http://124.89.101.2:8000

# DB 서비스 ip 예시
http://124.89.101.2:5432
```

- 그러나 IP 주소는 개발시에는 편리하나, 배포 단계에서 사용자 친화적이지 않음

### 인그레스(Ingress)

![Figure. Ingress](https://d33wubrfki0l68.cloudfront.net/91ace4ec5dd0260386e71960638243cf902f8206/c3c52/docs/images/ingress.svg){:.shadow}

- 외부 액세스를 서비스에 포워딩하는 API 객체로, 일반적으로 HTTP

### 컨피그맵(Config Map)

- 앱에 대한 환경 설정
- 포드 매핑 문제를 IP 주소가 아닌 고유 이름, 혹은 속성값으로 해결
- 시크릿을 하드 코딩할 수 있으나 권장되지 않음

### 시크릿(Secret)

- 환경 변수처럼 노출돼서는 안 될 데이터를 저장
- 컨피그맵과 함께 사용되며, 포드가 컨피그맵을 통해 필요한 시크릿들을 읽어들임

### 볼륨(Volume)

- 포드는 비영구적이기 때문에 데이터 소실 위험이 있음
- 영구적으로 데이터를 보관할 목적으로 클러스터 외부에 생성한 데이터 저장소를 일컬음
- k8s는 기본적으로 데이터의 영구성을 보장하지 않기 때문에 개발자가 이를 제어해야 함

### 디플로이먼트(Deployment)

- 디플로이먼트는 포드의 앱스트랙션(Abstraction)이고, 포드는 컨테이너의 앱스트랙션
- 실제로는 포드가 아닌 디플로이먼트로 작업
- k8s는 컨테이너가 다운되더라도 사용자 경험이 끊기지 않게끔 레플리카를 생성하는데, 이 레플리카에 생성에 사용되는 템플릿은 디플로이먼트에 정의
- 서비스가 레플리카에도 원본과 같은 IP를 할당
- 그러나 디플로이먼트로 DB 레플리카를 생성해서는 안 되는데, DB 컨테이너 간의 CRUD 싱크 문제가 발생하기 때문

### 스테이트풀셋(StatefulSet)

- DB는 디플로이먼트 대신 스테이트풀셋을 사용
- 하지만 스테이트풀셋을 배포하는 것은 쉽지 않기 때문에 주로 RDS 등을 사용하여 클러스터 외부에서 DB를 호스팅

### 요약

- 포드 - 컨테이너의 추상화
- 서비스 - 클러스터와 외부를 연결 짓는 통로
- 인그레스 - 클러스트로 오는 트래픽을 라우팅
- 컨피그맵과 시크릿 - 부수적인 환경 설정
- 볼륨 - 데이터를 영구적으로 보관하기 위한 수단
- 디플로이먼트와 스테이트풀셋 - 레플리카 관리를 위한 메커니즘

<br/>

## ✅ k8s의 아키텍쳐

![The Components of a Kubernetes Cluster](https://d33wubrfki0l68.cloudfront.net/2475489eaf20163ec0f54ddc1d92aa8d4c87c96b/e7c81/images/docs/components-of-kubernetes.svg){:.shadow}

### 노드(Node)

- 노드는 포드가 실행되는 물리적 환경으로, 노드들의 컬렉션이 곧 클러스터
- 마이크로서비스들이 통합적으로 기능하게 위한 최소 단위
- 워커 노드라고도 부르며, 클러스터 내의 실질적인 일꾼

### 컨트롤 플레인(Control Plane)

- 마스터 노드
- 노드의 생성 및 제거, 스케쥴링, 모니터링 등의 작업에는 k8s 클러스터와의 상호작용이 필요한데, 마스터 노드(마스터 프로세스)가 일임
- 마스터 프로세스의 구성 요소
  - API 서버 - 클러스터의 게이트웨이이자 게이트키퍼
  - 스케쥴러 - 워커 노드들의 리소스를 모니터링하여 어떤 노드에 포드를 생성할 것인지를 결정 (쿠블렛과 상호작용)
  - 컨트롤러 매니저 - 클러스트의 상태 변화를 감지하고 스케쥴러에 통신
  - ETCD - 클러스트의 뇌 역할로, 클러스트의 상태 변화를 키-값 쌍으로 저장; 클러스터에 관한 데이터를 관리할 뿐, 실제 앱 데이터는 관리하지 않음
- 리소스 소모량이 워커 노드보다 적음

### 쿠블렛(Kublet)

- 컨테이너와 노드를 연결
- 포드를 실행시키며, 이때 노드의 리소스를 포드에 할당
- 노드 마다 하나 이상의 쿠블렛이 존재

### 쿠브 프록시(Kube Proxy)

- 서비스의 구성 요소로, 리퀘스트를 포드에 포워딩
- 같은 노드 내의 포드들에만 포워딩될 수 있도록 보장
- 노드 마다 존재

</div>
